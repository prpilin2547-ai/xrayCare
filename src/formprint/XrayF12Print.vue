<template>
  <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏•‡πà‡∏á ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô -->
  <div class="print-root">
    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≠‡∏ô print) -->
    <div class="print-toolbar">
      <button class="btn-print" @click="handlePrint">
        üñ® ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å F12
      </button>
    </div>

    <!-- ‡πÅ‡∏ú‡πà‡∏ô A4 -->
    <div class="sheet-a4">
      <div class="sheet-inner">
        <!-- ‡∏´‡∏±‡∏ß‡∏ü‡∏≠‡∏£‡πå‡∏° -->
        <div class="header-main">
          <div class="title-main">
            ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å F12 : ‡πÅ‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ã‡πâ‡∏≥
          </div>
          <div class="title-sub">
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà : ‡∏ó‡∏∏‡∏Å 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
          </div>
        </div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏±‡∏ß‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© -->
        <div class="meta-block">
          <div class="meta-row">
            <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</span>
            <span class="fill-line">{{ header.hospital }}</span>
            <span class="meta-gap">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</span>
            <span class="fill-line">{{ header.department }}</span>
          </div>
          <div class="meta-row">
            <span>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô / ‡∏õ‡∏µ</span>
            <span class="fill-line">{{ header.monthYear }}</span>
          </div>
          <div class="meta-row">
            <span>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏ã‡πÄ‡∏£‡∏¢‡πå‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</span>
            <span class="fill-line">{{ header.machineBrand }}</span>
            <span class="meta-gap">‡∏£‡∏∏‡πà‡∏ô</span>
            <span class="fill-line short">{{ header.machineModel }}</span>
            <span class="meta-gap">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á S/N</span>
            <span class="fill-line short">{{ header.machineSn }}</span>
          </div>
          <div class="meta-row">
            <span>Application</span>
            <span class="fill-line">{{ header.application }}</span>
          </div>
          <div class="meta-row">
            <span>Calibration</span>
            <span class="fill-line">{{ header.calibration }}</span>
          </div>
        </div>

        <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ã‡πâ‡∏≥ -->
        <table class="f12-table">
          <thead>
            <tr>
              <th class="col-reason">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏≤‡∏á‡∏£‡∏±‡∏á‡∏™‡∏µ‡∏ã‡πâ‡∏≥</th>
              <th class="col-count">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="reason in reasons" :key="reason.code">
              <td class="align-left">
                {{ reason.code }} {{ reason.text }}
              </td>
              <td class="align-center">
                {{ reason.count }}
              </td>
            </tr>
          </tbody>
        </table>

        <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô / ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ã‡πâ‡∏≥ -->
        <div class="summary-block">
          <div class="summary-row">
            <span>‡∏£‡∏ß‡∏°</span>
            <span class="fill-line short">
              {{ summary.totalRepeat }}
            </span>
            <span>‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
          </div>
          <div class="summary-row">
            <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡πà‡∏≤‡∏¢</span>
            <span class="fill-line short">
              {{ summary.totalExams }}
            </span>
            <span>‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
          </div>
          <div class="summary-row">
            <span>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ã‡πâ‡∏≥</span>
            <span class="fill-line short">
              {{ summary.repeatRate }}
            </span>
            <span>%</span>
          </div>
        </div>

        <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ -->
        <div class="comment-block">
          <div class="comment-title">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ :</div>
          <div class="comment-line">
            {{ summary.commentLine1 }}
          </div>
          <div class="comment-line">
            {{ summary.commentLine2 }}
          </div>
        </div>

        <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏° PDF) -->
        <div class="note-block">
          <div class="note-title">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
          <div class="note-line">
            * ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ã‡πâ‡∏≥‡πÅ‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏†‡∏≤‡∏û (Image Artifact) ‡∏≠‡∏≤‡∏à‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 4 ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡πÑ‡∏î‡πâ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
          </div>
          <div class="note-line">
            1. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (Detector)
          </div>
          <div class="note-line">
            2. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÅ‡∏õ‡∏•‡∏Å‡∏õ‡∏•‡∏≠‡∏° (Foreign object) ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤ ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
          </div>
          <div class="note-line">
            3. ‡∏™‡∏≤‡∏£‡∏ó‡∏∂‡∏ö‡∏£‡∏±‡∏á‡∏™‡∏µ (contrast media)
          </div>
          <div class="note-line">
            4. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÅ‡∏õ‡∏•‡∏Å‡∏õ‡∏•‡∏≠‡∏°‡∏à‡∏≤‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏ï‡∏£‡∏ß‡∏à/Support/X-ray tube
          </div>
        </div>

        <!-- ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö -->
        <div class="sign-block">
          <div class="sign-row">
            ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ................................................................. ‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
          </div>
          <div class="sign-row">
            ( {{ footer.testerName }} )
          </div>
          <div class="sign-row">
            ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ............................................................
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from "vue";
import { useRoute } from "vue-router";

const route = useRoute();

// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏±‡∏ß‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô)
const header = ref({
  hospital: "",
  department: "",
  monthYear: "",
  machineBrand: "",
  machineModel: "",
  machineSn: "",
  application: "",
  calibration: ""
});

// ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ (1‚Äì9) + ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á
const reasons = ref([
  { code: "1.", text: "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (Positioning)", count: "" },
  { code: "2.", text: "‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏£‡∏±‡∏á‡∏™‡∏µ‡∏ú‡∏¥‡∏î (Exposure error)", count: "" },
  { code: "3.", text: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏¥‡πä‡∏î (Grid error)", count: "" },
  { code: "4.", text: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏†‡∏≤‡∏û (System error)", count: "" },
  { code: "5.", text: "‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏õ‡∏•‡∏Å‡∏õ‡∏•‡∏≠‡∏°‡πÉ‡∏ô‡∏†‡∏≤‡∏û (Artifact)", count: "" },
  { code: "6.", text: "‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢ (Patient motion)", count: "" },
  { code: "7.", text: "‡∏†‡∏≤‡∏û‡∏ó‡∏î‡∏™‡∏≠‡∏ö (Test image)", count: "" },
  { code: "8.", text: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û (Study canceled)", count: "" },
  { code: "9.", text: "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ", count: "" }
]);

// ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡∏∏‡∏õ
const summary = ref({
  totalRepeat: "",
  totalExams: "",
  repeatRate: "",
  commentLine1: "",
  commentLine2: ""
});

// ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≤‡∏¢‡∏ü‡∏≠‡∏£‡πå‡∏°
const footer = ref({
  testerName: ""
});

// ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå
function handlePrint() {
  window.print();
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å backend
onMounted(async () => {
  const id = route.params.id;

  // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á API ‚Äì ‡πÅ‡∏Å‡πâ URL / ‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö backend ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  /*
  const res = await fetch(`/api/forms/f12/${id}`);
  const data = await res.json();

  header.value = {
    hospital: data.header.hospital,
    department: data.header.department,
    monthYear: data.header.monthYear,
    machineBrand: data.header.machineBrand,
    machineModel: data.header.machineModel,
    machineSn: data.header.machineSn,
    application: data.header.application,
    calibration: data.header.calibration
  };

  reasons.value = data.reasons;      // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô array 1‚Äì9 ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô
  summary.value = data.summary;
  footer.value = { testerName: data.testerName };
  */
});
</script>

<style scoped>
@import url("https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap");

/* ‡πÉ‡∏ä‡πâ TH Sarabun ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
* {
  font-family: "TH Sarabun New", "Sarabun", Tahoma, sans-serif !important;
}

/* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ô‡∏≠‡∏Å */
.print-root {
  background: #111827;
  min-height: 100vh;
  padding: 16px 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* ‡∏õ‡∏∏‡πà‡∏° print */
.print-toolbar {
  margin-bottom: 16px;
}

.btn-print {
  padding: 6px 18px;
  background: #ffffff;
  border-radius: 999px;
  border: 1px solid #4b5563;
  cursor: pointer;
  font-size: 16px;
}

/* A4 */
.sheet-a4 {
  width: 210mm;
  min-height: 297mm;
  background: #ffffff;
  box-shadow: 0 0 4mm rgba(0, 0, 0, 0.35);
  display: flex;
  justify-content: center;
}

.sheet-inner {
  width: 180mm;
  padding: 18mm 0 14mm;
  font-size: 14pt;
}

/* Header */
.header-main {
  text-align: center;
  margin-bottom: 8mm;
}

.title-main {
  font-weight: 700;
  margin-bottom: 2mm;
  font-size: 18pt;
}

.title-sub {
  font-size: 16pt;
}

/* meta block */
.meta-block {
  margin-bottom: 6mm;
  font-size: 14pt;
}

.meta-row {
  display: flex;
  flex-wrap: wrap;
  gap: 4mm;
  margin-bottom: 2mm;
}

.fill-line {
  border-bottom: 0.4pt solid #000;
  min-width: 35mm;
  min-height: 6mm;
  padding: 0 2mm;
  display: inline-block;
}

.fill-line.short {
  min-width: 25mm;
}

.meta-gap {
  margin-left: 4mm;
}

/* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å */
.f12-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  font-size: 13pt;
  margin-bottom: 6mm;
}

.f12-table th,
.f12-table td {
  border: 0.4pt solid #000;
  padding: 1.5mm 1mm;
}

.col-reason {
  width: 75%;
}

.col-count {
  width: 25%;
}

.align-left {
  text-align: left;
}

.align-center {
  text-align: center;
}

/* ‡∏™‡∏£‡∏∏‡∏õ */
.summary-block {
  margin-bottom: 6mm;
  font-size: 14pt;
}

.summary-row {
  margin-bottom: 2mm;
}

/* ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ */
.comment-block {
  margin-bottom: 6mm;
  font-size: 14pt;
}

.comment-title {
  margin-bottom: 2mm;
}

/* ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ */
.note-block {
  margin-bottom: 10mm;
  font-size: 13pt;
}

.note-title {
  font-weight: 700;
  margin-bottom: 2mm;
}

.note-line {
  line-height: 1.2;
}

/* ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô */
.sign-block {
  margin-top: 8mm;
  text-align: center;
  font-size: 14pt;
}

.sign-row {
  margin-bottom: 2mm;
}

/* ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå */
@page {
  size: A4 portrait;
  margin: 10mm;
}

@media print {
  .print-toolbar {
    display: none;
  }

  .print-root {
    background: #ffffff;
    padding: 0;
  }

  .sheet-a4 {
    box-shadow: none;
    width: auto;
    min-height: auto;
  }
}
</style>
